# Location

## XML HL7 > JSON FHIR

A Location is mapped from a locatedEntity.

| Mapped to (JSON FHIR Document Reference field) | Mapped from (XML HL7 / other source)                                                                             |
|------------------------------------------------|------------------------------------------------------------------------------------------------------------------|
| meta.profile                                   | fixed value = `"https://fhir.nhs.uk/STU3/StructureDefinition/CareConnect-GPC-Location-1"`                        |
| identifier\[0].system                          | `"https://PSSAdaptor/{{losingOdsCode}}"` - where the `{{losingOdsCode}}` is the ODS code of the losing practice  |
| identifier\[0].value                           | Location ID (UUID) generated by the Adaptor                                                                      |
| id                                             | Location ID (UUID) generated by the Adaptor                                                                      |
| status                                         | fixed value = `"active"`                                                                                         |
| address                                        | `Location / locatedEntity / locatedPlace / addr ` <sup>1</sup>                                                   |
| name                                           | `Location / locatedEntity / locatedPlace / name `                                                                |
| telecom\[0]                                    | `Location / locatedEntity / locatedPlace / telecom[0]`                                                           |

1. The address is mapped using the same behaviour as the [Organisation](../organisations/README.md) address field.

### Unmapped fields

The following Location fields are not currently populated by the adaptor:

- implicitRules
- language
- operationalStatus
- text
- contained
- extension
- modifierExtension
- alias
- description
- mode
- type
- physicalType
- position
- managingOrganisation
- partOf
- endpoint

<details>
    <summary>Example JSON</summary>

```
{
    "resource": {
        "resourceType": "Location",
        "id": "DC28A497-E925-4697-BC59-B53B1905A65B",
        "meta": {
            "profile": [
                "https://fhir.nhs.uk/STU3/StructureDefinition/CareConnect-GPC-Location-1"
            ]
        },
        "identifier": [
            {
                "system": "https://PSSAdaptor/2167888433",
                "value": "DC28A497-E925-4697-BC59-B53B1905A65B"
            }
        ],
        "status": "active",
        "name": "Test Practice Location"
    }
}
```
</details>

## JSON FHIR > XML HL7

An Encounter with linked Location is mapped to a composition containing a location.

| Mapped to (XML HL7)                            | Mapped from (JSON FHIR / other source )          |
|------------------------------------------------|--------------------------------------------------|
| location / locatedEntity / code \[@code]       | fixed value = `'394730007'`                      |
| location / locatedEntity / code \[@codeSystem] | fixed value = `'2.16.840.1.113883.2.1.3.2.4.15'` |
| location / locatedEntity / locatedPlace / name | Location.name                                    |


<details><summary>Example XML</summary>

```
<component typeCode="COMP">
    <ehrComposition classCode="COMPOSITION" moodCode="EVN">
        <id root="CDFC5DF7-2D1B-4EBB-BE5C-6BD2E19405FF" />
        ...
        <location typeCode="LOC">
            <locatedEntity classCode="LOCE">
                <code code="394730007" codeSystem="2.16.840.1.113883.2.1.3.2.4.15" displayName="Healthcare related organisation" />
                <locatedPlace classCode="PLC" determinerCode="INSTANCE">
                    <name>Test Practice Location</name>
                </locatedPlace>
            </locatedEntity>
        </location>
        ...
    </ehrComposition>
</component>
```
</details>

## Further documentation

[FHIR specification](https://fhir.nhs.uk/STU3/StructureDefinition/CareConnect-GPC-Location-1)
[MIM 4.2.00](https://data.developer.nhs.uk/dms/mim/4.2.00/Index.htm) 
